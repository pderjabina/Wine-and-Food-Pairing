<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wine & Food Pairing — Neural Recommender (tf.js)</title>

  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@1.5.1/dist/tfjs-vis.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


 <style>
  /* ===== Theme tokens ===== */
  :root{
    --bg:#ffffff; --fg:#0f172a; --muted:#475569;
    --card:#f7f7fb; --border:#e5e7eb;
    --brand:#6b4de6; --brand-2:#8a6df1;
    --ring:0 0 0 3px rgba(107,77,230,.15);
  }
  body.dark{
    --bg:#0b1020; --fg:#e6e8ee; --muted:#97a1b3;
    --card:#121833; --border:#1f2649;
    --brand:#8a6df1; --brand-2:#b39cf9;
    --ring:0 0 0 3px rgba(179,156,249,.16);
  }

  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);
    font:16px/1.55 Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial}
  .container{max-width:1100px;margin:0 auto;padding:28px 20px 80px}

  h1{margin:0 0 6px;font-weight:800;letter-spacing:-.02em}
  h1 .sub{display:block;font-weight:500;font-size:14px;color:var(--muted)}
  h2{margin:0 0 12px;font-size:20px}
  p{margin:10px 0;color:var(--muted)}

  /* Sticky top bar */
  .topnav{position:sticky;top:0;z-index:50;backdrop-filter:blur(8px);
    background:color-mix(in oklab, var(--bg) 80%, transparent);
    border-bottom:1px solid var(--border)}
  .topnav .inner{max-width:1100px;margin:0 auto;padding:10px 20px;
    display:flex;gap:14px;align-items:center;justify-content:space-between}
  .brand{display:flex;align-items:center;gap:10px;font-weight:800}
  .brand .dot{width:10px;height:10px;border-radius:999px;
    background:linear-gradient(135deg,var(--brand),var(--brand-2));box-shadow:0 0 0 3px rgba(107,77,230,.18)}
  .tabs{display:flex;gap:8px;flex-wrap:wrap}
  .tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;
    background:var(--bg);color:var(--muted);text-decoration:none;font-size:14px}
  .tab:hover{border-color:var(--brand);color:var(--fg)}

  /* Layout + cards */
  section{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;margin:16px 0}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .row-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
  .card{background:var(--bg);border:1px solid var(--border);border-radius:14px;padding:14px}
  .note{background:var(--bg);border-left:4px solid var(--brand);border-radius:12px;padding:12px}

  .btn{background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#fff;border:none;
    padding:10px 14px;border-radius:12px;cursor:pointer;box-shadow:0 6px 18px rgba(107,77,230,.18);transition:.2s}
  .btn:hover{transform:translateY(-1px)}
  .btn:disabled{opacity:.5;cursor:not-allowed;box-shadow:none}

  label{display:block;font-weight:600;margin-bottom:6px}
  input[type=file], select{width:100%;background:var(--bg);color:var(--fg);border:1px solid var(--border);
    border-radius:12px;padding:10px;outline:none;transition:border-color .15s}
  input[type=file]:focus, select:focus{border-color:var(--brand);box-shadow:var(--ring)}

  table{width:100%;border-collapse:collapse;background:var(--bg);border-radius:12px;overflow:hidden}
  th,td{padding:10px 12px;border-bottom:1px solid var(--border);text-align:left}
  th{background:color-mix(in oklab, var(--bg) 92%, var(--brand) 8%);font-weight:700}
  tr:hover td{background:color-mix(in oklab, var(--bg) 95%, var(--brand) 5%)}

  .metrics{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .kpi{font-size:28px;font-weight:800}

  /* tfjs-vis panel: тень и граница; цвета берём из темы */
  tf-vis-panel{background:var(--bg)!important;color:var(--fg)!important;
    box-shadow:0 10px 40px rgba(0,0,0,.22);border-left:1px solid var(--border)}

  @media (max-width:980px){.row,.row-3,.metrics{grid-template-columns:1fr}}

   /* ==== EDA layout fixes ==== */
#eda .row {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 16px;
}

@media (max-width: 980px) {
  #eda .row { grid-template-columns: 1fr; }
}
   /* ==== EDA layout (fix height & grid) ==== */
#eda {                       /* сами графики в 2 колонки */
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}
@media (max-width:980px){
  #eda { grid-template-columns: 1fr; }
}

#eda .card{ overflow: hidden; }  /* канвас не “выпрыгивает” */

#eda canvas{                     /* ключ: жёсткая визуальная высота */
  display: block;
  width: 100% !important;
  height: 260px !important;
  max-height: 260px;
}


/* карты и канвасы не «выпрыгивают» */
#eda .card { overflow: hidden; }

/* фиксируем визуальную высоту графиков */
#eda canvas {
  display: block;
  width: 100% !important;
  height: 260px !important;   /* ключевая строка */
  max-height: 260px;
}
</style>

</head>
<body>
  <div class="topnav">
  <div class="inner">
    <div class="brand"><span class="dot"></span> Wine & Food Pairing</div>
    <div class="tabs">
      <a class="tab" href="#data">Data</a>
      <a class="tab" href="#model">Model</a>
      <a class="tab" href="#app">Prototype</a>
      <a class="tab" href="#deploy">Export</a>
      <button id="theme-toggle" class="tab" style="cursor:pointer">Dark</button>
    </div>
  </div>
</div>
  <div class="container">
    <h1>Wine & Food Pairing — Neural Recommender (TensorFlow.js)</h1>
    <div class="note">
      <div class="flex">
        <span class="pill">EDA</span>
        <span class="pill">One-Hot Encoding</span>
        <span class="pill">Dense NN (5-class)</span>
        <span class="pill">Confusion Matrix</span>
        <span class="pill">Interactive Recommendation</span>
      </div>
      <p style="margin:8px 0 0">
        Goal: predict <b>pairing_quality</b> (1–5) and power a simple <b>recommender</b> that helps a restaurant/menu app suggest better wine–food pairings.
      </p>
    </div>

    <!-- 1. Data -->
    <section id="data">
      <h2>1) Data</h2>
      <div class="row">
        <div>
          <label for="csv-file">Upload <code>wine_food_pairings.csv</code></label>
          <input id="csv-file" type="file" accept=".csv" />
        </div>
        <div class="card">
          <b>Status:</b> <span id="status">Waiting for CSV…</span><br/>
          <small>Columns: wine_type, wine_category, food_item, food_category, cuisine, pairing_quality, quality_label, description</small>
        </div>
      </div>
      <div class="flex" style="margin-top:12px">
        <button class="btn" id="btn-preview" disabled>Preview head()</button>
        <button class="btn" id="btn-eda" disabled>Run EDA</button>
        <button class="btn" id="btn-prep" disabled>Preprocess</button>
      </div>
      <div id="preview"></div>

<!-- сюда будем подливать маленькие “статы” EDA -->
<div id="eda-stats" class="row"></div>

<!-- а тут живут сами графики EDA -->
<div id="eda" class="row">
  <div class="card">
    <h3>Quality distribution</h3>
    <canvas id="eda-quality" height="220"></canvas>
  </div>
  <div class="card">
    <h3>Wine categories</h3>
    <canvas id="eda-winecat" height="220"></canvas>
  </div>
  <div class="card">
    <h3>Food categories</h3>
    <canvas id="eda-foodcat" height="220"></canvas>
  </div>
  <div class="card">
    <h3>Cuisines</h3>
    <canvas id="eda-cuisines" height="220"></canvas>
  </div>
</div>


    </section>

    <!-- 2. Model -->
    <section id="model">
      <h2>2) Modeling</h2>
      <div class="row">
        <div class="card">
          <h3 style="margin-top:0">Architecture</h3>
          <ul style="margin:6px 0 0 18px">
            <li>Inputs: one-hot of categorical features (wine_type, wine_category, food_item, food_category, cuisine)</li>
            <li>2× Dense (ReLU, dropout), output: 5-way softmax (classes 1–5)</li>
            <li>Loss: categoricalCrossentropy, Metric: accuracy</li>
          </ul>
      <div class="flex" style="margin-top:8px; align-items:center; gap:12px">
  <button class="btn" id="btn-build" disabled>Build Model</button>

  <label style="display:flex; align-items:center; gap:6px; font-size:14px;">
    <input type="checkbox" id="cb-balanced" />
    Use class weights
  </label>

  <button class="btn" id="btn-train" disabled>Train (80/20 split)</button>
  <button class="btn" id="btn-eval" disabled>Evaluate</button>
</div>

<div id="model-summary"></div>
<div id="training-vis"></div>

        </div>
        <div class="card">
          <h3 style="margin-top:0">Metrics</h3>
          <div class="metrics">
            <div>
              <b>Accuracy:</b> <span id="m-acc">–</span><br/>
              <b>Macro F1:</b> <span id="m-f1">–</span>
            </div>
            <div id="cm"></div>
            <div id="class-report"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- 3. Prototype -->
    <section id="app">
      <h2>3) Application Prototype: Interactive Recommendation</h2>
      <div class="row">
        <div class="card">
          <h3 style="margin-top:0">Try a pairing</h3>
          <div class="row">
            <div>
              <label>Wine Type</label>
              <select id="sel-wine-type"></select>
            </div>
            <div>
              <label>Wine Category</label>
              <select id="sel-wine-cat"></select>
            </div>
            <div>
              <label>Food Item</label>
              <select id="sel-food-item"></select>
            </div>
            <div>
              <label>Food Category</label>
              <select id="sel-food-cat"></select>
            </div>
            <div>
              <label>Cuisine</label>
              <select id="sel-cuisine"></select>
            </div>
          </div>
          <div class="flex" style="margin-top:12px">
            <button class="btn" id="btn-predict" disabled>Predict Quality</button>
            <button class="btn" id="btn-suggest" disabled>Suggest Better Wine</button>
          </div>
          <div id="pred-out" style="margin-top:10px"></div>
        </div>
        <div class="card">
          <h3 style="margin-top:0">Business Value</h3>
          <p style="margin:0">
            This model powers <b>menu intelligence</b>: for any dish, suggest wines with predicted score ≥4.
            Restaurants can <b>increase check size</b> via upsell of better pairings, e-commerce can <b>personalize recommendations</b>,
            and producers can spot <b>portfolio gaps</b> (dishes without high-scoring pairings).
          </p>
          <ul>
            <li><b>KPI uplift:</b> +CTR on suggested pairings, +conversion, +avg basket value</li>
            <li><b>Ops:</b> auto-curate wine lists for seasonal menus by cuisine/food category</li>
            <li><b>Insights:</b> heatmaps of success by wine/food categories for procurement</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- 4. Export / Deploy -->
    <section id="deploy">
      <h2>4) Export & Deploy</h2>
      <div class="flex">
        <button class="btn" id="btn-export" disabled>Export Model (.json + .bin)</button>
      </div>
      <div class="note" style="margin-top:10px">
        <ol style="margin:0 0 0 18px">
          <li>Commit <code>index.html</code>, <code>app.js</code>, and optionally <code>wine_food_pairings.csv</code> to a public repo</li>
          <li>Enable GitHub Pages → Branch: <b>main</b> → Folder: <b>/root</b></li>
          <li>PDF submission: include links to <b>app</b> and <b>code</b>, plus 1 slide on <b>business value</b></li>
        </ol>
      </div>
    </section>
  </div>

  <script src="app.js"></script>
<script>
window.addEventListener('load', () => {
  const waitPanel = setInterval(() => {
    const panel = document.querySelector('tf-vis-panel');
    if (!panel) return;

    clearInterval(waitPanel);
    panel.style.position = 'fixed';
    panel.style.right = '0';
    panel.style.top = '0';
    panel.style.zIndex = '9999';
    panel.style.transition = 'right 0.4s ease';

    // кнопка ⇔ для задвигания
    const btn = document.createElement('button');
    btn.textContent = '⇔';
    Object.assign(btn.style, {
      position: 'absolute',
      left: '-25px',
      top: '10px',
      width: '25px',
      height: '25px',
      cursor: 'pointer',
      borderRadius: '6px',
      border: 'none',
      background: '#6b4de6',
      color: '#fff',
      fontWeight: 'bold',
      fontSize: '16px',
      lineHeight: '25px'
    });
    panel.appendChild(btn);

    let hidden = false;
    btn.onclick = () => {
      hidden = !hidden;
      panel.style.right = hidden ? '-50%' : '0';
    };

    // перетаскивание панели мышкой
    let isDragging = false, startX, startRight;
    panel.addEventListener('mousedown', (e) => {
      if (e.target === btn) return; // не тянуть за кнопку
      isDragging = true;
      startX = e.clientX;
      startRight = parseInt(panel.style.right) || 0;
      panel.style.transition = 'none';
    });

    window.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      const delta = startX - e.clientX;
      const newRight = Math.max(Math.min(startRight + delta, 0), -window.innerWidth * 0.5);
      panel.style.right = `${newRight}px`;
    });

    window.addEventListener('mouseup', () => {
      if (isDragging) {
        isDragging = false;
        panel.style.transition = 'right 0.4s ease';
      }
    });
  }, 500);
});
</script>
  
<script>
  // smooth-scroll по табам
  document.querySelectorAll('.tab[href^="#"]').forEach(a=>{
    a.addEventListener('click', e=>{
      e.preventDefault();
      const el = document.querySelector(a.getAttribute('href'));
      el?.scrollIntoView({behavior:'smooth', block:'start'});
    });
  });

  // dark mode toggle + сохранение
  const KEY='wf-dark', body=document.body, t=document.getElementById('theme-toggle');
  if(localStorage.getItem(KEY)==='1'){ body.classList.add('dark'); t.textContent='Light'; }
  t?.addEventListener('click', ()=>{
    const dark = body.classList.toggle('dark');
    t.textContent = dark ? 'Light' : 'Dark';
    localStorage.setItem(KEY, dark ? '1' : '0');
  });
</script>
</body>
</html>

